# Docker Compose for WhatsApp Multi-Session Manager (Standalone)
# This version uses the pre-built Docker image from Docker Hub
# It does NOT include MySQL - use this if you already have MySQL running
# Image: rod16/whatsapp-multi-session:latest

version: '3.8'

services:
  whatsapp-multi-session:
    # Use pre-built image from Docker Hub
    image: rod16/whatsapp-multi-session:latest

    container_name: whatsapp-multi-session
    restart: unless-stopped

    # Run as www user (UID:GID 1001:1001) for security
    user: "1001:1001"

    ports:
      - "${PORT:-8080}:8080"

    env_file:
      - .env

    environment:
      # Application Configuration
      - PORT=${PORT:-8080}
      - JWT_SECRET=${JWT_SECRET}
      - GIN_MODE=${GIN_MODE:-release}

      # MySQL Database Configuration
      # IMPORTANT: Update these to match your existing MySQL
      - MYSQL_HOST=${MYSQL_HOST:-host.docker.internal}
      - MYSQL_PORT=${MYSQL_PORT:-3306}
      - MYSQL_USER=${MYSQL_USER:-root}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-waGo}
      - WHATSAPP_DB_PATH=/app/database/sessions.db

      # Default Admin User
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}

      # Session Configuration
      - MAX_SESSIONS=${MAX_SESSIONS:-10}
      - SESSION_TIMEOUT=${SESSION_TIMEOUT:-24h}
      - QR_TIMEOUT=${QR_TIMEOUT:-30s}

      # Webhook Configuration
      - WEBHOOK_TIMEOUT=${WEBHOOK_TIMEOUT:-30s}

    volumes:
      # Mount database directory for persistent WhatsApp sessions
      - ./whatsapp:/app/database
      # Mount config directory for environment files
      - ./config:/app/config
      # Mount logs directory
      - ./logs:/app/logs

    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

# Note: No MySQL service included - using your existing MySQL
# Update MYSQL_HOST in .env to point to your MySQL instance
# For local MySQL: use host.docker.internal
# For remote MySQL: use the actual hostname/IP
