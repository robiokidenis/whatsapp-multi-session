
services:
  whatsapp-multi-session:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whatsapp-multi-session
    restart: unless-stopped
    ports:
      - "${PORT:-8080}:8080"
    env_file:
      - .env
    environment:
      # Application Configuration
      - PORT=${PORT:-8080}
      - JWT_SECRET=${JWT_SECRET}
      - GIN_MODE=${GIN_MODE:-release}
      
      # Database Configuration
      - DATABASE_TYPE=${DATABASE_TYPE:-sqlite}
      - DATABASE_PATH=${DATABASE_PATH}
      - MYSQL_HOST=${MYSQL_HOST:-mysql}
      - MYSQL_PORT=${MYSQL_PORT:-3306}
      - MYSQL_USER=${MYSQL_USER:-root}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-waGo}
      
      # Default Admin User
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}
      
      # Application Settings
      - SESSION_TIMEOUT=${SESSION_TIMEOUT:-24h}
      - MAX_SESSIONS=${MAX_SESSIONS:-10}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      
      # WhatsApp Configuration
      - WHATSAPP_DB_PATH=${WHATSAPP_DB_PATH}
      - AUTO_CONNECT=${AUTO_CONNECT:-true}
      
      # Security Settings
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-*}
      - RATE_LIMIT=${RATE_LIMIT:-100}
      
    volumes:
      # Database storage - maps to local whatsapp directory
      - ${DATA_DIR:-./whatsapp}:/app/data
      
      # WhatsApp session storage
      - ${WHATSAPP_DIR:-./whatsapp/sessions}:/app/sessions
      
      # Application logs
      - ${LOGS_DIR:-./whatsapp/logs}:/app/logs
      
      # Optional: Custom configuration
      - ${CONFIG_DIR:-./config}:/app/config:ro
      
      # .env file loaded via env_file above
      
    networks:
      - whatsapp-network
   
    # Resource limits
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
        reservations:
          memory: 256M
          cpus: '0.5'
    
    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  whatsapp-network:
    driver: bridge
    name: whatsapp-network

volumes:
  mysql-data:

# Named volumes are defined but not used in favor of bind mounts
# Uncomment if you prefer named volumes over bind mounts
# volumes:
#   whatsapp-data:
#   whatsapp-sessions:
#   whatsapp-logs: