<!DOCTYPE html>
<html>
<head>
    <title>QR Code Test</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <h1>QR Code Test</h1>
    <button id="testBtn">Test QR Code Generation</button>
    <div id="status"></div>
    <div id="qrcode"></div>

    <script>
        document.getElementById('testBtn').addEventListener('click', function() {
            const status = document.getElementById('status');
            const qrDiv = document.getElementById('qrcode');
            
            status.innerHTML = 'Connecting to WebSocket...';
            qrDiv.innerHTML = '';
            
            const ws = new WebSocket('ws://localhost:8080/api/ws/6281234567890@s.whatsapp.net');
            
            ws.onopen = function() {
                status.innerHTML = 'Connected! Waiting for QR code...';
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log('Received:', data);
                
                if (data.type === 'qr') {
                    status.innerHTML = 'QR Code received! Generating image...';
                    
                    // Generate QR code
                    QRCode.toCanvas(qrDiv, data.data.qr, {
                        width: 256,
                        margin: 2
                    }, function(error) {
                        if (error) {
                            status.innerHTML = 'Error generating QR: ' + error;
                        } else {
                            status.innerHTML = 'QR Code ready! Scan with WhatsApp';
                        }
                    });
                } else if (data.type === 'error') {
                    status.innerHTML = 'Error: ' + data.error;
                } else if (data.type === 'success') {
                    status.innerHTML = 'Login successful!';
                } else {
                    status.innerHTML = 'Event: ' + data.type + ' - ' + (data.message || data.event);
                }
            };
            
            ws.onerror = function(error) {
                status.innerHTML = 'WebSocket error: ' + error;
                console.error('WebSocket error:', error);
            };
            
            ws.onclose = function(event) {
                status.innerHTML = 'Connection closed. Code: ' + event.code;
                console.log('WebSocket closed:', event);
            };
        });
    </script>
</body>
</html>